<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>IO Sano</title>

  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="apple-mobile-web-app-title" content="IO Sano"/>
  <meta name="application-name" content="IO Sano"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="theme-color" content="#667eea"/>

  <link rel="manifest" href="manifest.webmanifest"/>
  <link rel="apple-touch-icon" sizes="120x120" href="icons/icon-120.png"/>
  <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152.png"/>
  <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-167.png"/>
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180.png"/>
  <link type="image/png" rel="icon" sizes="192x192" href="icons/icon-192.png"/>
  <link type="image/png" rel="icon" sizes="512x512" href="icons/icon-512.png"/>

  <style>
:root {
      --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --card-bg: rgba(255, 255, 255, 0.96);
      --card-border: rgba(255, 255, 255, 0.55);

      --primary-grad: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --danger-grad: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      --success-grad: linear-gradient(135deg, #10b981 0%, #059669 100%);
      --orange-grad: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      --silver-grad: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);

      --text-dark: #1f2937;
      --text-muted: #6b7280;

      --radius-lg: 20px;
      --radius-md: 12px;

      /* ombre pi√π leggere = meno lavoro GPU su iOS */
      --shadow-soft: 0 8px 28px rgba(31, 38, 135, 0.12);

      /* Mappa responsive: celle scalabili (no overflow su mobile) */
      --cell-h: clamp(44px, 6.5vw, 55pt);
      --cell-gap: clamp(6px, 1.2vw, 12px);
      --axis-w: clamp(26px, 6vw, 34px);
      --axis-h: clamp(22px, 4.5vw, 28px);
    }

    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, system-ui, sans-serif;
      -webkit-tap-highlight-color: transparent;
    }

    html, body { height: 100%; }

    body {
      margin: 0;
      background: var(--bg-gradient);
      /* tolto background-attachment: fixed (spesso lagga su iOS/iPadOS) */
      color: var(--text-dark);
      line-height: 1.6;
      min-height: 100vh;
      padding-bottom: 80px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    main {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header: tolto backdrop-filter blur (principale fonte di sfarfallii su Safari) */
    header {
      background: rgba(255, 255, 255, 0.14);
      border-bottom: 1px solid rgba(255,255,255,0.28);
      padding: 1.2rem 1.5rem;
      padding-top: calc(1.2rem + env(safe-area-inset-top));
      position: sticky;
      top: 0;
      z-index: 50;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: white;
      text-shadow: 0 2px 4px rgba(0,0,0,0.12);
      box-shadow: 0 2px 10px rgba(0,0,0,0.10);
    }
    header h1 {
      margin: 0;
      font-size: 1.75rem;
      font-weight: 800;
      letter-spacing: 0.5px;
    }

    /* Tabs: tolto blur */
    .tabs {
      display: flex;
      gap: 15px;
      padding: 20px;
      position: sticky;
      top: calc(70px + env(safe-area-inset-top));
      z-index: 40;
    }
    .tab {
      flex: 1;
      text-align: center;
      padding: 14px 20px;
      border-radius: 40px;
      border: 2px solid rgba(255,255,255,0.10);
      background: rgba(255, 255, 255, 0.20);
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: transform 0.12s ease, background-color 0.15s ease, color 0.15s ease;
      box-shadow: 0 4px 12px rgba(0,0,0,0.10);
      user-select: none;
    }
    .tab.active{
  background:linear-gradient(135deg,#5a6df0,#7b3fe4);
  color:#fff;
  border:2px solid #2e1a72;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}
    .tab:not(.active):active { transform: scale(0.98); }

    .card {
      background: var(--card-bg);
      /* tolto blur */
      border: 1px solid var(--card-border);
      border-radius: var(--radius-lg);
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: var(--shadow-soft);
      transition: transform 0.12s ease;
    }
    .card:active { transform: scale(0.99); }

    label {
      display: block;
      font-size: 0.8rem;
      color: #4b5563;
      margin-bottom: 8px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    input[type=text], input[type=number], select {
      width: 100%;
      padding: 14px 18px;
      font-size: 1rem;
      border: 2px solid #c7d2fe;
      border-radius: var(--radius-md);
      background: #e5edff;
      color: #1f2937;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background-color 0.15s ease;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.08);
      font-weight: 500;
      outline: none;
    }
    input:focus, select:focus {
      background: white;
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.30);
    }
    input::placeholder { color: #9ca3af; font-weight: 400; }

    /* Campi MAPPA (gi√† migliorati): li lasciamo marcati */
    #cellDialog input[type=text],
    #colDialog select {
      background: #e5edff;
      border-color: #c7d2fe;
      box-shadow: inset 0 2px 6px rgba(0,0,0,0.08);
    }
    #cellDialog input[type=text]:focus,
    #colDialog select:focus {
      background: #ffffff;
      border-color: #4f46e5;
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.30);
    }

    button {
      padding: 12px 22px;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      border: none;
      transition: transform 0.10s ease, opacity 0.12s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      letter-spacing: 0.3px;
      white-space: nowrap;
      user-select: none;
      touch-action: manipulation;
    }
    button:active { transform: scale(0.97); }

    button:not(.ghost):not(.alt):not(.danger):not(.action-btn):not(.remove-grid):not(.go-to-map):not(.secondary) {
      background: var(--primary-grad);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.25);
    }

    button.ghost {
      background: white;
      border: 2px solid #e5e7eb;
      color: #4b5563;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    button.secondary {
      background: var(--silver-grad);
      border: 2px solid #d1d5db;
      color: #374151;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    button.danger {
      background: var(--danger-grad);
      color: white;
      box-shadow: 0 6px 18px rgba(239, 68, 68, 0.30);
    }

    button.alt, button.add-grid {
      background: var(--success-grad);
      color: white;
      box-shadow: 0 6px 18px rgba(16, 185, 129, 0.28);
    }

    button.remove-grid {
      background: var(--orange-grad);
      color: white;
      box-shadow: 0 6px 18px rgba(245, 158, 11, 0.28);
    }

    button.go-to-map {
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      color: white;
      box-shadow: 0 6px 18px rgba(99, 102, 241, 0.28);
    }

    .list-item .row button {
      flex: 1;
      height: 42px;
      padding: 0 12px;
      font-size: 0.9rem;
      border-radius: 10px;
      width: 100%;
    }

    /* tolta animazione slideIn (ricostruzioni lista = flicker) */
    .list-item {
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding: 20px;
      border-radius: var(--radius-md);
      background: white;
      margin-bottom: 14px;
      border-left: 5px solid #e5e7eb;
      box-shadow: 0 2px 10px rgba(0,0,0,0.06);
      transition: transform 0.12s ease, border-left-color 0.12s ease;
    }
    @media (min-width: 600px) {
      .list-item {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
      .list-item .row {
        width: auto;
        min-width: 280px;
      }
    }
    .list-item:active {
      transform: scale(0.99);
      border-left-color: #667eea;
    }
    .abbr { font-weight: 700; color: #111827; font-size: 1.1rem; }
    .muted { color: #6b7280; font-size: 0.9rem; margin-top: 4px; }
    .empty-state{
      display: none;
      padding: 18px 16px;
      border-radius: 16px;
      background: rgba(255,255,255,0.85);
      border: 2px dashed rgba(102, 126, 234, 0.35);
      color: #374151;
      font-weight: 700;
      text-align: center;
      margin-top: 14px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.06);
    }
    /* Lotto pi√π visibile nella lista */
    .list-item [data-detail]{ font-weight: 600; }


    .grid-wrap { overflow-x: hidden; padding-bottom: 15px; }
    .grid-scroll { -webkit-overflow-scrolling: touch; }
    .grid {
      display: grid;
      gap: var(--cell-gap);
      grid-auto-rows: var(--cell-h);
      grid-template-columns: repeat(var(--cols, 10), minmax(0, 1fr));
    }
    /* ====== assi numerati (mappa) ====== */
    .grid-frame{
      display: grid;
      grid-template-columns: var(--axis-w) 1fr var(--axis-w);
      grid-template-rows: var(--axis-h) 1fr var(--axis-h);
      gap: var(--cell-gap);
      align-items: start;
      width: 100%;
    }
    .axis{
      display: grid;
      gap: var(--cell-gap);
    }
    .axis-top, .axis-bottom{ align-items: center; }
    .axis-left, .axis-right{ grid-auto-rows: var(--cell-h); align-items: center; }
    .axis-corner{
      width: var(--axis-w);
      height: var(--axis-h);
    }
    .axis-cell{
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      font-weight: 800;
      font-size: 13px;
      color: #4338ca;
      background: rgba(102, 126, 238, 0.16);
      border: 1px solid rgba(102, 126, 238, 0.30);
      user-select: none;
      width: 100%;
    }
    .axis-top .axis-cell, .axis-bottom .axis-cell{
      height: var(--axis-h);
    }
    .axis-left .axis-cell, .axis-right .axis-cell{
      height: 100%;
    }


    .cell {
      overflow: hidden;
      width: 100%;
      height: 100%;
      border-radius: 12px;
      border: 3px solid rgba(0,0,0,0.06);
      background: linear-gradient(135deg, rgba(255,255,255,0.92) 0%, rgba(249,250,251,0.92) 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 8px;
      text-align: center;
      cursor: pointer;
      transition: transform 0.12s ease, border-color 0.12s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      user-select: none;
    }

    /* Empty state lista */
    .empty-state{
      padding: 18px;
      border-radius: 16px;
      border: 2px dashed rgba(99,102,241,0.35);
      background: rgba(255,255,255,0.85);
      color: #374151;
      font-weight: 800;
      text-align: center;
      margin-top: 14px;
    }
    .empty-state .muted{ font-weight: 700; }
    .cell:active { transform: scale(0.95); border-color: #7c3aed; }
    .cell.occ {
      background: linear-gradient(135deg, #ffffff 0%, #f3f4f6 100%);
      border-color: #8b5cf6;
      border-bottom-width: 5px;
      box-shadow: 0 4px 15px rgba(139, 92, 246, 0.12);
    }
    .cell.occ .name { color: #6d28d9; font-weight: 700; }
    .cell .name {
      font-weight: 600;
      font-size: 14px;
      line-height: 1.15;
      /* Permette al testo di andare a capo (niente puntini) */
      white-space: normal;
      overflow: hidden;
      text-overflow: clip;
      overflow-wrap: anywhere;
      word-break: break-word;
      max-width: 100%;
      /* Limite ‚Äúmorbido‚Äù a ~2 righe per non spingere fuori Lotto */
      max-height: 2.35em;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      /* Riserva sempre spazio per 2 righe, cos√¨ il Lotto finisce sempre in basso */
      min-height: 2.35em;

    }
    .cell .lot { margin-top: auto; font-size: 12px; font-weight: 600; opacity: 0.85; }

    .toolbar { display: flex; gap: 12px; flex-wrap: wrap; margin-top: 20px; }
    .row { display: flex; gap: 12px; width: 100%; flex-wrap: wrap; }
    .action-bar { display: flex; gap: 12px; width: 100%; flex-wrap: wrap; }

    .action-btn {
      flex: 1;
      height: 50px;
      border-radius: var(--radius-md);
      border: none;
      background: #374151;
      color: white;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      position: relative;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.10s ease;
      box-shadow: 0 4px 15px rgba(0,0,0,0.15);
      user-select: none;
    }
    .action-btn.pdf { background: var(--danger-grad); box-shadow: 0 4px 15px rgba(239, 68, 68, 0.28); }
    .action-btn.import { background: var(--success-grad); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.26); }
    .action-btn:active { transform: scale(0.98); }
    .action-btn input[type="file"] { position: absolute; inset: 0; opacity: 0; cursor: pointer; }

    .pill {
      background: white;
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 0.9rem;
      color: #4b5563;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border: 2px solid #e5e7eb;
    }
    .badge {
      background: var(--success-grad);
      color: white;
      padding: 8px 16px;
      border-radius: 25px;
      font-size: 0.9rem;
      font-weight: 700;
      box-shadow: 0 6px 18px rgba(16, 185, 129, 0.30);
    }

    h3.section {
      margin: 30px 0 20px;
      font-size: 1.35rem;
      color: #1f2937;
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
    }
    h3.section::before {
      content: '';
      width: 10px;
      height: 10px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      box-shadow: 0 0 0 5px rgba(102, 126, 234, 0.18);
    }

    dialog {
      background: rgba(255,255,255,0.98);
      border: 2px solid rgba(255,255,255,0.6);
      border-radius: 24px;
      padding: 32px;
      width: 450px;
      max-width: 92%;
      box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.25);
      /* tolto blur */
      max-height: 90vh;
      overflow-y: auto;
      opacity: 0;
      transform: translateY(10px) scale(0.98);
    }
    dialog[open]{
      opacity: 1;
      transform: translateY(0) scale(1);
      animation: dialogIn 0.16s ease-out;
    }
    @keyframes dialogIn{
      from{ opacity: 0; transform: translateY(10px) scale(0.98); }
      to{ opacity: 1; transform: translateY(0) scale(1); }
    }
    dialog::backdrop { background: rgba(30, 27, 75, 0.7); }
    dialog h3 {
      margin-top: 0;
      font-size: 1.6rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
      margin-bottom: 1.5rem;
    }

    #cellDialog .row { justify-content: stretch; }
    #cellDialog .row button {
      flex: 1 1 45%;
      min-width: 140px;
      white-space: normal;
      height: auto;
      padding: 14px 10px;
    }

    #notification-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.7);
      z-index: 100;
      display: flex;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.15s ease;
    }
    #notification-modal.show { visibility: visible; opacity: 1; }
    .modal-content {
      background: white;
      padding: 36px;
      border-radius: 24px;
      width: 380px;
      text-align: center;
      box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.25);
      transform: scale(0.98);
      transition: transform 0.15s ease;
    }
    #notification-modal.show .modal-content { transform: scale(1); }

    footer {
      text-align: center;
      padding: 25px;
      font-size: 0.9rem;
      color: rgba(255,255,255,0.9);
      margin-top: 50px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    footer strong { color: white; font-weight: 700; }

    footer.install {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: white;
      padding: 18px;
      display: none;
      box-shadow: 0 -15px 40px -5px rgba(0,0,0,0.15);
      z-index: 100;
      justify-content: space-between;
      align-items: center;
      border-top-left-radius: 24px;
      border-top-right-radius: 24px;
    }

    @media (max-width: 600px) {
      header h1 { font-size: 1.5rem; }
      .tabs { padding: 15px; gap: 10px; }
      .tab { padding: 12px 16px; font-size: 0.9rem; }
      h3.section { font-size: 1.2rem; }
    }

    @media (prefers-reduced-motion: reduce) {
      * { transition: none !important; }
      .tab.active{
  background:linear-gradient(135deg,#5a6df0,#7b3fe4);
  color:#fff;
  border:2px solid #2e1a72;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}
      button:active, .cell:active, .list-item:active, .card:active { transform: none; }
      #notification-modal, .modal-content { transition: none !important; }
    }
  
  
  /* ===== Aggiunte: pill scadenza/giacenza (additive) ===== */
  .tagline { margin-top: 8px; display:flex; gap:10px; flex-wrap:wrap; }
  .tag {
    display:inline-flex; align-items:center; gap:8px;
    padding: 6px 12px; border-radius: 999px;
    font-size: 0.82rem; font-weight: 800;
    background: #fff; border: 2px solid #e5e7eb;
    box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    color: #374151;
  }
  .tag.red { border-color: rgba(239,68,68,0.55); color:#991b1b; }
  .tag.yellow { border-color: rgba(245,158,11,0.55); color:#92400e; }
  .tag.green { border-color: rgba(16,185,129,0.55); color:#065f46; }
  .tag.skull { border-color: rgba(0,0,0,0.35); color:#111827; }
  .smallmeta { margin-top:6px; font-size:0.82rem; color:#6b7280; font-weight:700; }
  .pill-prel {
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding: 6px 12px;
    border-radius: 999px;
    font-size: 0.82rem;
    font-weight: 900;
    border: 2px solid rgba(239,68,68,0.45);
    color: #991b1b;
    background: rgba(255,255,255,0.9);
    margin-left: 10px;
  }
  
/* === FIX UI FILTRI & RICERCA === */
.filter-tabs {
  display:flex;
  gap:12px;
  margin-bottom:14px;
}

.search-wrap {
  position:relative;
}

.search-wrap .icon {
  position:absolute;
  left:14px;
  top:50%;
  transform:translateY(-50%);
  pointer-events:none;
  opacity:.6;
}

#search {
  padding-left:44px;
}

.tab {
  transition: background .15s, box-shadow .15s, transform .1s;
}

.tab:active {
  transform: scale(0.97);
}

.tab.active{
  background:linear-gradient(135deg,#5a6df0,#7b3fe4);
  color:#fff;
  border:2px solid #2e1a72;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}


/* === RESPONSIVE REFINEMENTS === */

/* Toolbar spacing */
.toolbar, .filter-tabs {
  flex-wrap: wrap;
  row-gap: 12px;
}

/* Separate reset filters from import/export */
.actions-group {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  margin-top: 10px;
}

.actions-group .spacer {
  flex: 1 1 100%;
}

/* Product list buttons */
[data-btns] {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
  gap: 8px;
  margin-top: 10px;
}

/* Buttons consistency */
button {
  min-height: 44px;
  border-radius: 14px;
}

/* Tablet-specific tuning */
@media (min-width: 600px) and (max-width: 900px) {
  .filter-tabs button {
    flex: 1 1 22%;
  }
  [data-btns] {
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  }
}

/* Small screens */
@media (max-width: 480px) {
  .filter-tabs button {
    flex: 1 1 48%;
  }
}


/* === UI TWEAKS V2 === */

/* Move Reset Filters slightly up */
#resetSearchBtn {
  margin-top: -6px;
  align-self: center;
}

/* Active TAB: visible ring on light background */
.tab.active{
  background:linear-gradient(135deg,#5a6df0,#7b3fe4);
  color:#fff;
  border:2px solid #2e1a72;
  box-shadow:0 6px 18px rgba(0,0,0,.25);
}

/* Press feedback remains */
.tab:active {
  transform: scale(0.97);
}


/* === FINAL FILTER LAYOUT FIX === */
.filter-reset-row {
  margin-top: 10px;
  margin-bottom: 18px; /* creates clear separation from import/export */
}


</style>
</head>
<body>
<header>
  <div><h1>IO Sano</h1></div>
  <button class="ghost" id="undoBtn" style="display:none; padding: 8px 16px; font-size: 0.85rem; border-radius: 25px;">‚Ü∂ Annulla</button>
</header>

<nav class="tabs">
  <button class="tab active" id="tab-lista" type="button">Lista Prodotti</button>
  <button class="tab" id="tab-mappa" type="button">Mappa</button>
  <button class="tab" id="tab-stats" type="button">Statistiche</button>
</nav>

<main>
  <section id="view-lista">
    <div class="card">
      <h3 class="section" style="margin-top:0">Nuovo Inserimento</h3>
      <div class="row" style="align-items:flex-end; flex-wrap:wrap;">
        <div style="flex:1; min-width:200px">
          <label for="name">Descrizione Prodotto</label>
          <input id="name" placeholder="Nome prodotto..." type="text" autocomplete="off" spellcheck="false"/>
        </div>
        <div style="flex:1; min-width:200px">
          <label for="lot">Numero Lotto</label>
          <input id="lot" placeholder="Numero lotto..." type="text" autocomplete="off" spellcheck="false"/>
        </div>
        <div style="flex:1; min-width:200px">
          <label for="expiry">Data Scadenza</label>
          <input id="expiry" placeholder="Es: GEN/26 oppure GEN/26-FEB/26" type="text" autocomplete="off" spellcheck="false"/>
        </div>
      </div>
      <div class="toolbar" style="justify-content: flex-end; margin-top: 20px;">
        <button class="ghost" id="clearBtn" type="button">Pulisci</button>
        <button id="saveBtn" type="button" style="min-width: 120px;">Salva</button>
      </div>
    </div>

    <div class="card" style="padding: 20px 28px;">
      <div style="position:relative;">
        
<div class="filter-tabs">
  <button class="tab active" data-list-filter="all" type="button">Tutti</button>
  <button class="tab" data-list-filter="scaffale" type="button">Scaffale</button>
  <button class="tab" data-list-filter="terra" type="button">Terra</button>
  <button class="tab" data-list-filter="prelievo" type="button">Prelievo</button>
</div>
<div class="search-wrap"><span class="icon">üîç</span><input id="search" placeholder="Cerca per nome o lotto..." type="text" style="padding-left: 45px;" autocomplete="off" spellcheck="false"/>
        <span style="position:absolute; left:15px; top:50%; transform:translateY(-50%); opacity:0.5; font-size: 1.2rem;">üîç</span>
      </div>
      <div class="filter-reset-row" style="display:flex; justify-content:flex-end; gap:12px; margin-top:12px;">
        <button class="ghost" id="resetSearchBtn" type="button">Resetta filtri</button>
      </div>

      <div id="listEmptyState" class="empty-state"></div>
    </div>

    <div class="card">
      <div class="action-bar">
        <button id="exportPdfBtn" class="action-btn pdf" type="button">PDF</button>
        <button id="exportJsonBtn" class="action-btn" type="button" style="background: #4b5563;">JSON</button>
        <button class="action-btn import" type="button">
          Importa
          <input id="importJsonFile" type="file" accept="application/json"/>
        </button>
      </div>
    </div>

    <div class="card">
      <h3 class="section">Prodotti su scaffali</h3>
      <div id="listUnplaced"></div>
    </div>

    <div class="card">
      <h3 class="section">Prodotti a terra</h3>
      <div id="listPlaced"></div>
    </div>
  </section>

  <section id="view-mappa" style="display:none">
    <div class="card">
      <div style="display:flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
        <div style="display:flex; gap:10px">
          <div class="pill">Righe: 7</div>
          <div class="pill">Colonne: 10</div>
        </div>
        <div class="badge" id="occupiedBadge">Occupate: 0</div>
      </div>
    </div>

    <div class="card grid-wrap">
      <div class="grid-scroll">
        <div class="grid-frame" id="gridFrame">
          <div class="axis-corner" aria-hidden="true"></div>
          <div class="axis axis-top" id="axisTop" aria-label="Numeri colonne sopra"></div>
          <div class="axis-corner" aria-hidden="true"></div>

          <div class="axis axis-left" id="axisLeft" aria-label="Numeri righe sinistra"></div>
          <div class="grid" id="grid"></div>
          <div class="axis axis-right" id="axisRight" aria-label="Numeri righe destra"></div>

          <div class="axis-corner" aria-hidden="true"></div>
          <div class="axis axis-bottom" id="axisBottom" aria-label="Numeri colonne sotto"></div>
          <div class="axis-corner" aria-hidden="true"></div>
        </div>
      </div>
    </div>
  </section>

  <section id="view-stats" style="display:none">
    <div class="card">
      <h3 class="section" style="margin-top:0">Statistiche</h3>
      <div id="statsSummary" class="muted" style="font-weight:700"></div>
    </div>

    <div class="card">
      <h3 class="section">Top inseriti / eliminati</h3>
      <div class="row" style="gap:14px; align-items:stretch">
        <div style="flex:1; min-width:240px">
          <div class="pill" style="margin-bottom:10px; display:inline-block">Top inseriti</div>
          <div id="statsTopAdded"></div>
        </div>
        <div style="flex:1; min-width:240px">
          <div class="pill" style="margin-bottom:10px; display:inline-block">Top eliminati</div>
          <div id="statsTopRemoved"></div>
        </div>
      </div>
      <div id="statsAvgDwell" class="muted" style="margin-top:14px; font-weight:700"></div>
    </div>

    <div class="card">
      <h3 class="section">Raggruppamento scadenze</h3>
      <div class="row" style="gap:14px">
        <div style="flex:1; min-width:240px">
          <div class="pill" style="margin-bottom:10px; display:inline-block">‚ò†Ô∏è Scaduti</div>
          <div id="statsListSkull"></div>
        </div>
        <div style="flex:1; min-width:240px">
          <div class="pill" style="margin-bottom:10px; display:inline-block">üî¥ Rossi (&lt; 6 mesi)</div>
          <div id="statsListRed"></div>
        </div>
      </div>
      <div class="row" style="gap:14px; margin-top:14px">
        <div style="flex:1; min-width:240px">
          <div class="pill" style="margin-bottom:10px; display:inline-block">üü° Gialli (6‚Äì9 mesi)</div>
          <div id="statsListYellow"></div>
        </div>
        <div style="flex:1; min-width:240px">
          <div class="pill" style="margin-bottom:10px; display:inline-block">üü¢ Verdi (&gt; 9 mesi)</div>
          <div id="statsListGreen"></div>
        </div>
      </div>
    </div>
  </section>
</main>

<footer class="install" id="installBar">
  <span style="font-weight:600; color:#374151">Installa app per uso offline.</span>
  <button id="installBtn" type="button" style="background:var(--primary-grad); color:white; border-radius:25px; box-shadow:none;">Installa Ora</button>
</footer>

<footer>
  Applicazione ideata e sviluppata da <strong>Fabio Barbieri</strong>
</footer>

<template id="list-item-tpl">
  <div class="list-item">
    <div style="min-width:0">
      <div class="abbr"></div>
      <div class="muted" data-detail=""></div>
    </div>
    <div class="row" data-btns="" style="flex:0 0 auto; gap:8px"></div>
  </div>
</template>

<dialog id="cellDialog">
  <form method="dialog">
    <h3 id="cellTitle">Dettaglio Cella</h3>
    <label for="dName">Descrizione</label>
    <input id="dName" type="text" style="margin-bottom:12px" autocomplete="off" spellcheck="false"/>
    <label for="dLot">Lotto</label>
    <input id="dLot" type="text" autocomplete="off" spellcheck="false"/>
    <label for="dExpiry" style="margin-top:12px">Data Scadenza</label>
    <input id="dExpiry" type="text" placeholder="Es: GEN/26" autocomplete="off" spellcheck="false"/>
    <div class="row" style="margin-top:24px;"></div>
  </form>
</dialog>

<dialog id="colDialog">
  <form method="dialog">
    <h3>Scegli colonna</h3>
    <label for="colSelect">Colonna di destinazione</label>
    <select id="colSelect" style="margin-bottom:20px"></select>
    <div class="row" style="margin-top:24px; justify-content: flex-end;">
      <button class="ghost" type="button" id="colCancel">Annulla</button>
      <button type="button" id="colOk" class="alt">Conferma Spostamento</button>
    </div>
  </form>
</dialog>

<dialog id="editDialog">
  <form method="dialog">
    <h3>Modifica Prodotto</h3>
    <label for="eName">Descrizione</label>
    <input id="eName" type="text" style="margin-bottom:12px" autocomplete="off" spellcheck="false"/>
    <label for="eLot">Lotto</label>
    <input id="eLot" type="text" style="margin-bottom:12px" autocomplete="off" spellcheck="false"/>
    <label for="eExpiry">Data Scadenza</label>
    <input id="eExpiry" type="text" placeholder="Es: GEN/26" autocomplete="off" spellcheck="false"/>
    <div class="row" style="margin-top:24px; justify-content:flex-end;">
      <button class="ghost" type="button" id="eCancel">Annulla</button>
      <button type="button" id="eSave" class="alt">Salva</button>
    </div>
  </form>
</dialog>

<div id="notification-modal">
  <div class="modal-content">
    <h3 id="modalTitle">Titolo</h3>
    <p id="modalMessage" style="color: #6b7280; margin: 16px 0 24px;">Messaggio</p>
    <div class="row" style="justify-content: flex-start; gap: 10px;">
      <button class="ghost" id="modalCancelBtn" type="button">Annulla</button>
      <button id="modalConfirmBtn" type="button">OK</button>
    </div>
  </div>
</div>

<script type="module" src="./js/app.js"></script>
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./service-worker.js');
}
</script>
</body>
</html>
